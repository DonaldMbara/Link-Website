<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Add To Calendar</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- <script type="text/javascript" src = "../js/calendar.js"></script> -->
    <script src = "../js/calendar.js" async=""></script>
    <script>
      // window.onload = function() {
      // $(document).ready(function () {

      let calendarShow = 1;
      function settingDate(date, day){
        date = new Date(date);
        date.setDate(day);
        date.setHours(23);
        return date;
      }

      function getDatesBetween(date1, date2){
        let range1 = new Date(date1);
        let range2 = new Date(date2);
        date1 = settingDate(date1, 31);
        date2 = settingDate(date2, 31);
        let temp;
        let dates = [];
        while(date1 <= date2){
          if(date1.getDate() != 31){
            temp = settingDate(date1, 0);
            if(temp >=range1 && temp <= range2)  dates.push(temp);
            date1 = settingDate(date1, 31);
          }else{
            temp = new Date(date1);
            if(temp >= range1 && temp <= range2) dates.push(temp);

            date1.setMonth(date1.getMonth()+1);
          }
        }

        console.log(dates);
        let content = "<div class='calendarBtns'> <button id='calendarPrev' onclick='callPrev()' disabled>Prev</button> | <button id='calendarNext'  onclick='callNext()'>Next</button></div>";
        let weekDays = [
          {shortDay: "Mon", fullDay: "Monday"},
          {shortDay: "Tue", fullDay: "Tuesday"},
          {shortDay: "Wed", fullDay: "Wednesday"},
          {shortDay: "Thu", fullDay: "Thursday"},
          {shortDay: "Fri", fullDay: "Friday"},
          {shortDay: "Sat", fullDay: "Saturday"},
          {shortDay: "Sun", fullDay: "Sunday"}
        ];

        let lastDate, firstDate;
        for (let i =0; i < dates.length;i++){
          lastDate = dates[i];
          firstDate = new Date(dates[i].getFullYear(), dates[i].getMonth(),1);
          content+= "<div id='calendarTable_" + (i+1) +"' class='calendarDiv'>";
          content+= "<h2>" +
                  firstDate.toString().split(" ")[1]+
                  "-" +
                  firstDate.getFullYear()+
                  "</h2>";
          content+= "<table class='calendarTable' id='table_id'>";
          content+= "<thead >";

          //  Getting full day name
          weekDays.map(item=>{
            content+= "<th>"+item.fullDay+"</th>";
          });
          content+= "</thead>";
          //
          // // Getting the days
          content+= "<tbody >";
          let j =1;
          let displayNum, idMonth;

          while(j <= lastDate.getDate()){
            let theMonth = firstDate.getMonth();
            let theYear = firstDate.getFullYear();
            content+= "<tr >";
            for (let k=0; k < 7;k++){
              displayNum = j < 10 ? "0" + j : j;
              if (j == 1){
                if(firstDate.toString().split(" ")[0] == weekDays[k].shortDay){
                  content += "<td onclick='trClick("+displayNum+","+theMonth+","+theYear+")'>"+displayNum+"</td>";
                  j++;
                }else{
                  content += "<td></td>";
                }
              } else if (j > lastDate.getDate()) {
                content += "<td></td>";
              }else{
                content += "<td onclick='trClick("+displayNum+","+theMonth+","+theYear+")'>"+displayNum+"</td>";
                j++;
              }
            }
            content+= "</tr>";
            // j++;
          }
          content+="</tbody>";
          content+= "</table>";
          content+= "</div>";
        }
        return content;
      }
      //
      function trClick(day,month,year){
        let datelog = "" + day +" "+month +" "+year;
        // alert(datelog);
        localStorage.setItem("keyDay", day);
        localStorage.setItem("keyMonth", month);
        localStorage.setItem("keyYear", year);

        window.location.href = "../html/logevent.html";

        // alert(year);
      }


      function callPrev(){
        let alltable = document.getElementsByClassName("calendarDiv");
        document.getElementById('calendarNext').disabled = false;
        calendarShow--;
        if(calendarShow >= 1){
          for(let i=0; i < alltable.length;i++){
            alltable[i].style.display = "none";
          }
          document.getElementById("calendarTable_"+ calendarShow).style.display= "block";
          if(calendarShow == 1){
            document.getElementById('calendarPrev').disabled = true;
          }
        }

      }

      function callNext(){
        // window.location.reload(true);
        // alert("Poop");
        let alltable = document.getElementsByClassName("calendarDiv");
        document.getElementById('calendarPrev').disabled = false;
        calendarShow++;
        if(calendarShow <= alltable.length){
          for(let i=0; i < alltable.length;i++){
            alltable[i].style.display = "none";
          }
          document.getElementById("calendarTable_"+ calendarShow).style.display= "block";
          if(calendarShow == alltable.length){
            document.getElementById('calendarNext').disabled = true;
          }
        }
      }

      let content = getDatesBetween("2020/01/01", "2021/01/01");
      window.onload = function what(){
        document.getElementById("the_calendar").innerHTML = content;
      };
    </script>
    <style>
    body{
      background: linear-gradient(to left, #8942a8, #ba382f );
    }
        #calendar {
          width: 80%;
          margin-left: 10%;
          margin-top: 60px;
        }
        .calendarTable{
          width:100%;
          border: 1px solid #000;
        }

        .calendarTable thead tr th{
          background: #000;
          border-bottom: 1px solid #000;
          padding: 20px 0px;
          color: #fff;
        }
        .calendarTable tr td{
          text-align: center;
          padding: 20px 0px;
          border: 1px solid #ccc;
          cursor: pointer;
          background: #dadada;
        }
        .calendarBtns{
          padding: 10px 0;
          width: 100%;

        }
        .calendarBtns button{
          padding: 6px 12px;
          font-size: 18px;
          border-radius: 6px;
          cursor: pointer;
        }

        .calendarDiv{
          display: none;
        }

        #calendarTable_1{
          display: block;
        }
    </style>

    <script>



</script>
  </head>
<body>
    <div id="the_calendar"></div>

  </body>
</html>

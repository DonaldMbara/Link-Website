<!DOCTYPE html>
<html lang="en">
<head>

    <!--You can host everything locally instead-->
    <title>Link Website login</title>
    <meta charset="UTF-8">
    <!--Bootstrap-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--css file-->
    <link rel="stylesheet" type="text/css" href="../css/login-register.css">
    <!--loading jQuery library-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!--js file-->
    <script type="text/javascript" src="../js/login.js"></script>

    <!--Here we prevent the browser back button-->
    <script type="text/javascript">
        function preback() { window.history.forward();}
        setTimeout("preback()",0);

        window.onload = function () {null};

    </script>



</head>
<body>

<script>
    $(document).ready(function () {
        $('#login-form').submit(function (e) {
            e.preventDefault();


            let studentNo = $('#login_stdNo').val();
            let password = $('#login_password').val();




            $(".error").remove(); //removing everything else that is in the span before using it

            //Checking validation of our inputs
            if (studentNo.length < 1 ) {
                $('#login_stdNo').after('<span class="error">This field is required</span>');
            }
            if( password.length < 1) {
                $('#login_password').after('<span class="error">Password must be at least 8 characters long</span>');
            }



            $.ajax({
                header: {"Access-Control-Allow-Origin" :"*"},
                type: "POST",
                url: 'https://lamp.ms.wits.ac.za/~s1819369/login.php',
                data: {
                    studentNo: studentNo,
                    password :password

                },
                success: function (data) {

                    // alert(data);
                    /*
                      *data is from the php file, I made it send response and username
                      * so data = 'data match-username' if successful or data = 'try again-username'
                      * here I split so that i can get username and response separately
                     */
                    let arr  = data.split("-");
                    let response = arr[0];
                    let username = arr[arr.length-1];
                    localStorage.setItem("username", username);


                    alert(response);
                    if(response === 'data matched'){
                        window.location = 'home.html?username='+ encodeURIComponent(username); //passed the username with the link, now check home.html at the top
                        localStorage.setItem("key", studentNo);
                    }
                    if(response === 'try again'){
                        alert('Invalid Credentials')
                    }

                },
            });

        });
    });

</script>
<div class="login-page">
    <div class="form">
        <!--Login form -->
        <form class="form" id="login-form" method="POST">
            <h1>Login</h1>
            <div class="textbox">
                <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                <input type="text" id="login_stdNo" placeholder="Student Number" name="login_stdNo" value=""/>

            </div>

            <div class="textbox">
                <i class="fa fa-lock" aria-hidden="true"></i>
                <input type="password" id="login_password" placeholder="Password" name="login_password" value="">

            </div>

            <input class="button"  type="submit"  value="Sign in">
            <p class="message"> Don't have an account? <a href="register.html">Register here</a>
            </p>
        </form>

    </div>
</div>


</body>
</html>
<?php include("https://lamp.ms.wits.ac.za/~s1819369/upload_image.php"); ?>

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Profile Page</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name = "viewport" content="width-device-width, initial-scale=1">
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src = "../js/profile.js"></script>

    <script type="text/javascript" src = "../js/uploadPic.js"></script>


  </head>

  <body>

    <script>
      $(document).ready(function (){
        var response = '';


        var s = localStorage.getItem("key");
        let static_studentNumber = s;


        $.ajax({
          header: {"Access-Control-Allow-Origin" : "*"},
          type: "GET",
          url: 'https://lamp.ms.wits.ac.za/~s1819369/profile.php',

          data: {
            studentNo : static_studentNumber
          },
          success : function(output){
            var obj = JSON.parse(output);
            firstname = obj.FirstName;
            surname = obj.LastName;
            username = obj.Username;
            e_mail = obj.email;
            localStorage.setItem("Fname", firstname);
            // alert(e_mail);
            $('#text2').html("Name : ".concat(firstname));
            $('#text1').html("LastName : ".concat(surname));
            $('#text3').html("Username : ".concat(username));
            $('#text4').html("Email : ".concat(e_mail));


          }

        });

    }
      );

    </script>

  <script>
    window.onload = function() {
      // Get the modal
      var modal = document.getElementById("myModal");

      // Get the button that opens the modal
      var btn = document.getElementById("myBtn");

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks the button, open the modal
      btn.onclick = function () {
        modal.style.display = "block";
      }

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = "none";
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    }
  </script>
  <script>
    function previewFile(input){
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function(e) {
            $('#profilePic').attr('src', e.target.result);
          }

          reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
      }


    function getUsername(){

      let data = window.location; //the whole link
      data = data.toString(); //set it to string
      let arr = data.split("username="); //split and get the link
      let username =  arr[arr.length-1];

      let path = "home.html?username=" + decodeURIComponent(username);
      path = path.toString();
      return path ; //set the link of the html page with the username on it

    }


  </script>


    <div class="header">
        <h1>My Profile</b></h1>
    </div>

    <div class="wrapper">
      <div id="prof-from" class="profile-form">


        <div>
            <div class="aside">
                <img  id="profilePic" class="profileHead" src="../image/profiledoji.png" alt="Placeholder">
            </div>
        </div>


        <button id="myBtn"><i class="fa fa-camera" aria-hidden="true"></i>
        </button>


        <!-- The Modal -->
        <div id="myModal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <span class="close">&times;</span>
            <p>Upload picture</p>
            <form method="post"  enctype="multipart/form-data">
              <label>Select Image File:</label>
              <input type="file" id="file" onchange="previewFile(this);" name="image" required>
              <input type="submit"  id="upload" name="submit" value="Upload">
            </form>
            <!-- Display response messages -->
            <?php if(!empty($resMessage)) {?>
            <div class="alert <?php echo $resMessage['status']?>">
              <?php echo $resMessage['message']?>
            </div>
            <?php }?>
          </div>

        </div>


        <div id="text1" class="contents">
          surname Loading...

        </div>

        <div id="text2" class="contents">
          firstname Loading...

        </div>

        <div id="text3" class="contents">
          username Loading...

        </div>

        <div id="text4" class="contents">
          email Loading...

        </div>



      </div>



    </div>

    <div class="container">
  <div class="btn-holder">

        <!-- This will direct to chats, for now its the home page -->



            <button id="view_chats"  onclick="window.location = '../html/chats_users.html'" name="" style="position: absolute; : 0">View Chats</button> <!--need username-->
  </div>

  <div class="btnc-holder">

      <!-- This will direct to chats, for now its the home page -->



          <button id="calendar"  onclick="window.location = '../html/calendar.html'" name="" style="position: absolute; : 0">Add to calendar</button>
  </div>


</div>








  </body>
</html>
